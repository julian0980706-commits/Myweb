<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¨‚é¤æ—¥æ›† | ç­ç´šè¨‚é¤</title>
    
    <!-- æ¨£å¼ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- FullCalendar æ—¥æ›†åº« -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    
    <style>
        /* åŸºç¤é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #1e293b;
            min-height: 100vh;
            padding-bottom: 70px;
        }
        
        /* é ‚éƒ¨æ¨™é¡Œæ¬„ */
        .header-bar {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: #475569;
            font-weight: 500;
            font-size: 1rem;
        }
        
        .page-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            text-align: center;
            flex: 1;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #475569;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        /* æ—¥æ›†å®¹å™¨ */
        .calendar-container {
            padding: 20px 16px;
        }
        
        #calendar {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }
        
        /* è‡ªè¨‚æ—¥æ›†æ¨£å¼ */
        .fc {
            --fc-border-color: #e2e8f0;
            --fc-button-bg-color: #f1f5f9;
            --fc-button-border-color: #e2e8f0;
            --fc-button-hover-bg-color: #e2e8f0;
            --fc-button-hover-border-color: #cbd5e1;
            --fc-button-active-bg-color: #3b82f6;
            --fc-button-active-border-color: #3b82f6;
            --fc-event-bg-color: #3b82f6;
            --fc-event-border-color: #2563eb;
        }
        
        .fc-toolbar-title {
            font-size: 1.3rem !important;
            font-weight: 600 !important;
            color: #1e293b !important;
        }
        
        .fc-col-header-cell {
            background: #f8fafc !important;
            padding: 12px 0 !important;
            font-weight: 600 !important;
            color: #475569 !important;
        }
        
        .fc-daygrid-day {
            transition: all 0.2s;
        }
        
        .fc-daygrid-day:hover {
            background: #f1f5f9 !important;
        }
        
        .fc-day-today {
            background: #eff6ff !important;
        }
        
        .fc-event {
            border-radius: 8px !important;
            border: none !important;
            padding: 6px 8px !important;
            font-size: 0.85rem !important;
            margin: 2px 0 !important;
            cursor: pointer;
        }
        
        /* å¿«é€Ÿè¨‚é¤å€ */
        .quick-orders {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin: 20px 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .order-item {
            background: #f8fafc;
            border-radius: 14px;
            padding: 18px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .order-item:hover {
            border-color: #3b82f6;
            transform: translateX(4px);
        }
        
        .order-info {
            flex: 1;
        }
        
        .order-date {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .order-restaurant {
            font-size: 1.1rem;
            font-weight: 600;
            color: #3b82f6;
            margin-bottom: 4px;
        }
        
        .order-detail {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .order-status {
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: 500;
            white-space: nowrap;
            margin-left: 12px;
        }
        
        .status-open {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-closed {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-adjust {
            background: #fef3c7;
            color: #92400e;
        }
        
        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #e2e8f0;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #64748b;
            font-size: 0.8rem;
            flex: 1;
            height: 100%;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .nav-item.active {
            color: #3b82f6;
        }
        
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }
        
        .nav-item.active i {
            transform: translateY(-2px);
        }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading.show {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ç„¡è³‡æ–™æç¤º */
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }
        
        .no-data i {
            font-size: 3rem;
            margin-bottom: 16px;
            color: #cbd5e1;
        }
        
        .create-schedule-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .create-schedule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        
        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 768px) {
            .calendar-container {
                padding: 16px 12px;
            }
            
            #calendar {
                padding: 16px;
            }
            
            .quick-orders {
                margin: 16px 12px;
                padding: 20px;
            }
            
            .fc-event {
                font-size: 0.75rem !important;
                padding: 4px 6px !important;
            }
        }
        
        @media (max-width: 480px) {
            .fc-toolbar-title {
                font-size: 1.1rem !important;
            }
            
            .order-item {
                padding: 15px;
            }
            
            .order-restaurant {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- é ‚éƒ¨æ¨™é¡Œæ¬„ -->
    <div class="header-bar">
        <a href="index.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            è¿”å›
        </a>
        <div class="page-title">è¨‚é¤æ—¥æ›†</div>
        <div class="header-actions">
            <button class="action-btn" id="todayBtn" title="å›åˆ°ä»Šå¤©">
                <i class="fas fa-calendar-day"></i>
            </button>
            <button class="action-btn" id="refreshBtn" title="é‡æ–°æ•´ç†">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>
    
    <!-- æ—¥æ›†å®¹å™¨ -->
    <div class="calendar-container">
        <div id="calendar"></div>
    </div>
    
    <!-- å¿«é€Ÿè¨‚é¤å€ -->
    <div class="quick-orders">
        <div class="section-title">
            <i class="fas fa-bolt"></i>
            è¿‘æœŸè¨‚é¤ (æœªä¾†14å¤©)
        </div>
        <div class="orders-list" id="ordersList">
            <!-- è¨‚é¤é …ç›®ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>
    
    <!-- åº•éƒ¨å°èˆª -->
    <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            é¦–é 
        </a>
        <a href="order.html" class="nav-item">
            <i class="fas fa-edit"></i>
            é»é¤
        </a>
        <a href="calendar-new.html" class="nav-item active">
            <i class="far fa-calendar"></i>
            æ—¥æ›†
        </a>
        <a href="guide.html" class="nav-item">
            <i class="fas fa-info-circle"></i>
            æŒ‡å—
        </a>
    </div>
    
    <!-- è¼‰å…¥å‹•ç•« -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>è¼‰å…¥æ—¥æ›†ä¸­...</p>
    </div>
    
    <!-- JavaScript åº« -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/zh-tw.js"></script>
    
    <script>
        // ============================================
        // å…¨åŸŸè®Šæ•¸
        // ============================================
        let calendar = null;
        
        // ============================================
        // ä¸»åˆå§‹åŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“… æ–°ç‰ˆæ—¥æ›†è¼‰å…¥å®Œæˆ');
            
            // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
            document.getElementById('loading').classList.add('show');
            
            // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
            setTimeout(() => {
                initCalendar();
                loadAndDisplayOrderList();
                
                // è¨­å®šæŒ‰éˆ•äº‹ä»¶
                setupButtonEvents();
                
                // éš±è—è¼‰å…¥å‹•ç•«
                document.getElementById('loading').classList.remove('show');
                
                // é¡¯ç¤ºæç¤ºï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨æ™‚ï¼‰
                checkFirstTimeUse();
            }, 800);
        });
        
        // ============================================
        // æ ¸å¿ƒåŠŸèƒ½ï¼šæ—¥æ›†åˆå§‹åŒ–
        // ============================================
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'zh-tw',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth'
                },
                height: 'auto',
                events: loadCalendarEvents(),
                eventClick: handleEventClick,
                eventContent: renderEventContent,
                dateClick: handleDateClick,
                datesSet: handleDatesChange
            });
            
            calendar.render();
        }
        
        // ============================================
        // äº‹ä»¶è™•ç†å‡½æ•¸
        // ============================================
        function handleEventClick(info) {
            const event = info.event;
            const props = event.extendedProps;
            
            if (props.status === 'open' && props.formId && props.restaurant !== 'èª¿æ•´ä¸­') {
                const formUrl = `forms/${props.formId}.html`;
                
                // æª¢æŸ¥è¡¨å–®æ˜¯å¦å­˜åœ¨
                fetch(formUrl, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = formUrl;
                        } else {
                            showAlert(`è¡¨å–® ${props.formId} å°šæœªå»ºç«‹`, 'warning');
                        }
                    })
                    .catch(() => {
                        showAlert(`ç„¡æ³•è¼‰å…¥è¡¨å–®: ${props.formId}`, 'error');
                    });
            } else {
                const message = props.restaurant === 'èª¿æ•´ä¸­' 
                    ? 'æœ¬æ—¥é¤å»³èª¿æ•´ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸ' 
                    : props.description || 'æ­¤æ—¥æœŸç„¡æ³•è¨‚é¤';
                showAlert(message, 'info');
            }
        }
        
        function handleDateClick(info) {
            const clickedDate = info.dateStr;
            const clickedDateObj = new Date(clickedDate);
            
            // æª¢æŸ¥é€™ä¸€å¤©æ˜¯å¦æœ‰å®‰æ’
            const schedule = getFormSchedule();
            const formForDate = schedule.find(form => {
                const formDate = new Date(form.date).toISOString().split('T')[0];
                return formDate === clickedDate;
            });
            
            if (formForDate && formForDate.status === 'open' && formForDate.id) {
                window.location.href = `forms/${formForDate.id}.html`;
                return;
            }
            
            // é¡¯ç¤ºæ—¥æœŸè³‡è¨Š
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = clickedDateObj.toLocaleDateString('zh-TW', options);
            
            const userAction = confirm(`${dateStr}\n\né€™ä¸€å¤©æ²’æœ‰å®‰æ’è¨‚é¤ï¼Œæ˜¯å¦è¦å‰å¾€å¾Œå°è¨­å®šï¼Ÿ`);
            if (userAction) {
                window.open('admin-simple.html', '_blank');
            }
        }
        
        function handleDatesChange(info) {
            console.log('æ—¥æ›†è¦–åœ–è®Šæ›´:', info.view.type);
            // å¯åœ¨æ­¤è™•è¼‰å…¥æ›´å¤šäº‹ä»¶è³‡æ–™
        }
        
        // ============================================
        // è³‡æ–™è™•ç†å‡½æ•¸
        // ============================================
        function loadCalendarEvents() {
            const schedule = getFormSchedule();
            
            if (schedule.length === 0) {
                return generateSampleEvents();
            }
            
            return schedule.map(form => {
                const eventDate = new Date(form.date);
                const dayOfWeek = eventDate.getDay();
                
                return {
                    id: form.id || `form_${form.date}`,
                    title: form.restaurant || form.name || 'æœªå®‰æ’',
                    start: eventDate,
                    allDay: true,
                    backgroundColor: getEventColor(form.status, dayOfWeek, form.restaurant),
                    borderColor: getEventBorderColor(form.status),
                    extendedProps: {
                        formId: form.id,
                        status: form.status || 'open',
                        restaurant: form.restaurant || form.name,
                        dateStr: eventDate.toISOString().split('T')[0],
                        description: getEventDescription(form, eventDate)
                    }
                };
            });
        }
        
        function getFormSchedule() {
            try {
                const saved = localStorage.getItem('form_schedule');
                if (!saved) return [];
                
                const schedule = JSON.parse(saved);
                
                // ç¢ºä¿æ—¥æœŸæ˜¯ Date ç‰©ä»¶
                return schedule.map(item => ({
                    ...item,
                    date: new Date(item.date)
                }));
            } catch (error) {
                console.error('è®€å–è¡¨å–®å®‰æ’å¤±æ•—:', error);
                return [];
            }
        }
        
        // ============================================
        // å¿«é€Ÿè¨‚é¤åˆ—è¡¨
        // ============================================
        function loadAndDisplayOrderList() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '';
            
            const schedule = getFormSchedule();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // ç¯©é¸æœªä¾†14å¤©å…§çš„è¨‚é¤
            const futureEvents = schedule
                .filter(form => {
                    const formDate = new Date(form.date);
                    formDate.setHours(0, 0, 0, 0);
                    const daysDiff = Math.ceil((formDate - today) / (1000 * 60 * 60 * 24));
                    return daysDiff >= 0 && daysDiff <= 14;
                })
                .slice(0, 8); // æœ€å¤šé¡¯ç¤º8å€‹
            
            if (futureEvents.length === 0) {
                showNoScheduleMessage(ordersList);
                return;
            }
            
            // å»ºç«‹è¨‚é¤é …ç›®
            futureEvents.forEach(form => {
                createOrderListItem(form, ordersList);
            });
        }
        
        function createOrderListItem(form, container) {
            const date = new Date(form.date);
            const dateStr = date.toLocaleDateString('zh-TW', {
                month: 'short',
                day: 'numeric',
                weekday: 'short'
            });
            
            const orderItem = document.createElement('div');
            orderItem.className = 'order-item';
            orderItem.dataset.formId = form.id;
            
            // æ±ºå®šç‹€æ…‹é¡åˆ¥
            let statusClass = 'status-closed';
            let statusText = 'å·²æˆªæ­¢';
            
            if (form.status === 'open') {
                statusClass = form.restaurant === 'èª¿æ•´ä¸­' ? 'status-adjust' : 'status-open';
                statusText = form.restaurant === 'èª¿æ•´ä¸­' ? 'èª¿æ•´ä¸­' : 'å¯è¨‚è³¼';
            }
            
            orderItem.innerHTML = `
                <div class="order-info">
                    <div class="order-date">${dateStr}</div>
                    <div class="order-restaurant">${form.restaurant || form.name}</div>
                    <div class="order-detail">
                        ${form.restaurant === 'èª¿æ•´ä¸­' ? 'æœ¬æ—¥é¤å»³èª¿æ•´' : 
                          form.status === 'open' ? 'å¯è¨‚è³¼ä¸­' : 'å·²æˆªæ­¢'}
                    </div>
                </div>
                <div class="order-status ${statusClass}">
                    ${statusText}
                </div>
            `;
            
            orderItem.addEventListener('click', function() {
                if (form.status === 'open' && form.id && form.restaurant !== 'èª¿æ•´ä¸­') {
                    window.location.href = `forms/${form.id}.html`;
                } else {
                    const message = form.restaurant === 'èª¿æ•´ä¸­' 
                        ? 'æœ¬æ—¥é¤å»³èª¿æ•´ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸ' 
                        : 'æ­¤æ—¥æœŸå·²æˆªæ­¢è¨‚è³¼';
                    showAlert(message, 'info');
                }
            });
            
            container.appendChild(orderItem);
        }
        
        function showNoScheduleMessage(container) {
            container.innerHTML = `
                <div class="no-data">
                    <i class="fas fa-calendar-plus"></i>
                    <p>å°šæœªè¨­å®šè¨‚é¤å®‰æ’</p>
                    <p style="font-size: 0.9rem; margin-top: 8px; color: #94a3b8;">
                        è«‹å…ˆåˆ°å¾Œå°è¨­å®šè¡¨å–®å®‰æ’
                    </p>
                    <button class="create-schedule-btn" id="gotoAdminBtn">
                        <i class="fas fa-cog"></i>
                        å‰å¾€å¾Œå°è¨­å®š
                    </button>
                    <button class="create-schedule-btn" id="createSampleBtn" style="margin-top: 10px; background: linear-gradient(135deg, #10b981, #059669);">
                        <i class="fas fa-magic"></i>
                        ç”¢ç”Ÿç¯„ä¾‹å®‰æ’
                    </button>
                </div>
            `;
            
            // ç¶å®šæŒ‰éˆ•äº‹ä»¶
            document.getElementById('gotoAdminBtn').addEventListener('click', function() {
                window.open('admin-simple.html', '_blank');
            });
            
            document.getElementById('createSampleBtn').addEventListener('click', createSampleSchedule);
        }
        
        // ============================================
        // å·¥å…·å‡½æ•¸
        // ============================================
        function getEventColor(status, dayOfWeek, restaurant) {
            if (status === 'closed') return '#ef4444';
            if (restaurant === 'èª¿æ•´ä¸­') return '#f59e0b';
            if (dayOfWeek === 3) return '#8b5cf6'; // é€±ä¸‰ç‰¹æ®Šé¡è‰²
            return '#3b82f6';
        }
        
        function getEventBorderColor(status) {
            if (status === 'closed') return '#dc2626';
            return '#2563eb';
        }
        
        function getEventDescription(form, date) {
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const dayOfWeek = weekdays[date.getDay()];
            const dateStr = date.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric' });
            
            if (form.restaurant === 'èª¿æ•´ä¸­') {
                return `é€±${dayOfWeek} (${dateStr}) Â· é¤å»³èª¿æ•´`;
            }
            
            if (form.status === 'closed') {
                return `é€±${dayOfWeek} (${dateStr}) Â· å·²æˆªæ­¢`;
            }
            
            return `é€±${dayOfWeek} (${dateStr}) Â· å¯è¨‚è³¼`;
        }
        
        function renderEventContent(info) {
            const event = info.event;
            const props = event.extendedProps;
            const date = event.start;
            
            let icon = 'ğŸ“‹';
            if (props.status === 'closed') icon = 'âŒ';
            if (props.restaurant === 'èª¿æ•´ä¸­') icon = 'ğŸ”„';
            
            // é¡¯ç¤ºæ—¥æœŸå’Œé¤å»³ï¼ˆç¸®çŸ­é¡¯ç¤ºï¼‰
            const day = date.getDate();
            const restaurant = props.restaurant || 'æœªå®‰æ’';
            const displayRestaurant = restaurant.length > 6 
                ? restaurant.substring(0, 5) + '..' 
                : restaurant;
            
            return {
                html: `
                    <div style="padding: 4px; font-size: 0.8em; min-height: 50px; cursor: pointer;">
                        <div style="font-size: 0.7em; color: #666; margin-bottom: 2px; font-weight: 500;">
                            ${day}æ—¥
                        </div>
                        <div style="font-weight: 600; margin-bottom: 2px; line-height: 1.2;">
                            ${icon} ${displayRestaurant}
                        </div>
                        <div style="font-size: 0.65em; color: #666; line-height: 1.1;">
                            ${props.status === 'open' ? 'å¯è¨‚è³¼' : 'å·²æˆªæ­¢'}
                        </div>
                    </div>
                `
            };
        }
        
        // ============================================
        // æŒ‰éˆ•äº‹ä»¶è¨­å®š
        // ============================================
        function setupButtonEvents() {
            // å›åˆ°ä»Šå¤©
            document.getElementById('todayBtn').addEventListener('click', function() {
                if (calendar) {
                    calendar.today();
                    showAlert('å›åˆ°ä»Šå¤©', 'success');
                }
            });
            
            // é‡æ–°æ•´ç†
            document.getElementById('refreshBtn').addEventListener('click', function() {
                document.getElementById('loading').classList.add('show');
                
                setTimeout(() => {
                    if (calendar) {
                        calendar.refetchEvents();
                    }
                    loadAndDisplayOrderList();
                    document.getElementById('loading').classList.remove('show');
                    showAlert('è³‡æ–™å·²é‡æ–°æ•´ç†', 'success');
                }, 800);
            });
            
            // å°èˆªæŒ‰éˆ•æç¤º
            document.querySelectorAll('.nav-item').forEach(item => {
                if (!item.classList.contains('active')) {
                    item.addEventListener('click', function(e) {
                        if (!this.href || this.href.includes('#')) {
                            e.preventDefault();
                            const pageName = this.querySelector('span')?.textContent || 'é é¢';
                            showAlert(`${pageName}å³å°‡æ¨å‡ºï¼`, 'info');
                        }
                    });
                }
            });
        }
        
        // ============================================
        // ç¯„ä¾‹è³‡æ–™ç”¢ç”Ÿ
        // ============================================
        function createSampleSchedule() {
            const schedule = [];
            const today = new Date();
            const restaurants = [
                'æµ·å—é›é£¯', 'æ± ä¸Šä¾¿ç•¶', 'è€ç‹ç‰›è‚‰éºµ', 'è¼•é£Ÿæ²™æ‹‰åŠ', 
                'ç¾å¼æ¼¢å ¡ç‹', 'å—æ´‹å’–å“©å±‹', 'æ—¥å¼ä¸¼é£¯', 'æ¸¯å¼ç‡’è‡˜',
                'ç¾©å¤§åˆ©éºµ', 'éŸ“å¼æ‹Œé£¯', 'ç´ é£Ÿé¤å»³', 'æ»·å‘³å°ˆè³£',
                'ç‚’é£¯ç‚’éºµ', 'å°ç«é‹', 'æŠ«è–©åº—'
            ];
            
            for (let i = 0; i < 15; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const dayOfWeek = date.getDay();
                
                const restaurant = restaurants[i % restaurants.length];
                
                // æ¨¡æ“¬é€±ä¸‰ä¸é–‹çš„åº—ï¼ˆæ¸¯å¼ç‡’è‡˜ï¼‰
                let status = 'open';
                let finalRestaurant = restaurant;
                
                if (restaurant === 'æ¸¯å¼ç‡’è‡˜' && dayOfWeek === 3) {
                    finalRestaurant = 'èª¿æ•´ä¸­';
                    status = 'closed';
                }
                
                schedule.push({
                    id: `form${i + 1}`,
                    name: `è¡¨å–®${i + 1}`,
                    date: date.toISOString(),
                    restaurant: finalRestaurant,
                    status: status
                });
            }
            
            localStorage.setItem('form_schedule', JSON.stringify(schedule));
            
            // é‡æ–°è¼‰å…¥é é¢
            showAlert('å·²ç”¢ç”Ÿç¯„ä¾‹å®‰æ’ï¼', 'success');
            setTimeout(() => {
                location.reload();
            }, 1500);
        }
        
        function generateSampleEvents() {
            const events = [];
            const today = new Date();
            
            for (let i = 1; i <= 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                events.push({
                    id: `sample_${i}`,
                    title: 'ç¯„ä¾‹é¤å»³',
                    start: date,
                    allDay: true,
                    backgroundColor: '#3b82f6',
                    extendedProps: {
                        formId: `form${i}`,
                        status: 'open',
                        restaurant: 'ç¯„ä¾‹é¤å»³',
                        description: 'è«‹è¨­å®šæ­£å¼å®‰æ’'
                    }
                });
            }
            
            return events;
        }
        
        // ============================================
        // ä½¿ç”¨è€…é«”é©—å‡½æ•¸
        // ============================================
        function checkFirstTimeUse() {
            const hasVisited = localStorage.getItem('calendar_visited');
            if (!hasVisited) {
                setTimeout(() => {
                    showAlert('âœ¨ æ­¡è¿ä½¿ç”¨è¨‚é¤æ—¥æ›†ï¼é»æ“Šæ—¥æœŸæŸ¥çœ‹è©³ç´°è³‡è¨Š', 'info');
                    localStorage.setItem('calendar_visited', 'true');
                }, 2000);
            }
        }
        
        function showAlert(message, type = 'info') {
            // ç°¡å–®çš„alertï¼Œå¯æ›¿æ›ç‚ºæ›´æ¼‚äº®çš„toast
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';
            alert(`${icon} ${message}`);
        }
        
        // ============================================
        // åˆå§‹åŒ–å®Œæˆ
        // ============================================
        console.log('æ—¥æ›†ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>